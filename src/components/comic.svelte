<script>
  export let src;
  export let alt;
  export let title;

  function preloadInNewSrc(node, src) {
    if (!node.previousElementSibling || node.complete) return;

    node.previousElementSibling.classList.remove("hidden");
    node.classList.add("loading");
    node.onload = () => {
      node.previousElementSibling.classList.add("hidden");
      node.classList.remove("loading");
    };
  }

  export function withPreload(node, src) {
    preloadInNewSrc(node, src);

    return {
      update(src) {
        if (node.src !== src) {
          preloadInNewSrc(node, src);
        }
      }
    };
  }
</script>

<style>
  .img-container {
    position: relative;
  }
  .preload {
    padding-bottom: 99.798994974874372%;
    background: url("data:image/png;base64,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");
    background-size: contain;
  }
  :global(.hidden).preload {
    display: none;
  }

  .img {
    max-width: 100%;
    display: block;
  }
  :global(.loading).img {
    position: absolute;
    top: 0;
    left: 0;
  }
</style>

<div class="img-container {$$props.class}">
  <div class="preload hidden" />
  <img {src} {alt} {title} class="img" use:withPreload={src} />
</div>
